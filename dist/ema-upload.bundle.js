(function(){"use strict";async function i({patientId:e,patientLname:r,patientFname:a,drug:t,file:n}){if(!(n instanceof Blob))throw new Error("`file` must be a Blob or File");const d=[{patient:{id:e,lastName:r,firstName:a},additionalInfo:{performedDate:new Date().toISOString()},fileName:n.name,title:`${t} pa submitted: ${new Date().toLocaleDateString()}`}],s=new FormData;s.append("dtoList",new Blob([JSON.stringify(d)],{type:"application/json"}),"dtoList.json"),s.append("files",n,n.name);const o=await fetch("https://khasak.ema.md/ema/ws/v3/fileAttachment/upload",{method:"POST",credentials:"include",body:s});if(!o.ok){const c=await o.text();throw new Error(`Upload failed ${o.status}: ${c}`)}return o.json()}chrome.runtime.onMessage.addListener(async(e,r,a)=>{if(e.action==="uploadPdf")return i(e.payload).then(t=>a({success:!0,data:t})).catch(t=>a({success:!1,error:t.message})),!0})})();
